/*1311591654,176833975*/

if (window.CavalryLogger) { CavalryLogger.start_js(["GBzRm"]); }

if(!window.CommentAdminPanelController){window.CommentAdminPanelController=function(a){copy_properties(this,{channel:a.channel,controllerID:a.controllerID,commentIDs:a.commentIDs,domIDs:a.domIDs,blacklistedActors:a.blacklistedActors,actorToCommentInfoMap:a.actorToCommentIDMap,commentInfoMap:a.commentInfoMap,inAggregatedView:a.inAggregatedView,inModerationQueue:a.inModerationQueue,inContextualDialog:a.inContextualDialog,loggedIn:a.loggedIn,userOwnsPages:a.userOwnsPages,recentlyBlacklistedActors:a.blacklistedActors});this.controlledRegion=$(this.controllerID);this.attachClickHandlers();if(this.inModerationQueue)this.registerModeratorQueueHandlers(true);if(this.inContextualDialog)this.attachContextualDialogHandlers();if(!this.inAggregatedView)UnverifiedXD.init({autoResize:true,channelUrl:a.channel,hideOverflow:true,newResizeMethod:true,resizeWidth:false});};copy_properties(CommentAdminPanelController,{allControllers:{},mainController:null,contextualControllers:{},initController:function(c){var a=new CommentAdminPanelController(c);var b=c.controllerID;CommentAdminPanelController.allControllers[b]=a;if(a.inContextualDialog){CommentAdminPanelController.contextualControllers[b]=a;}else CommentAdminPanelController.mainController=a;},syncController:function(c,a){var b=CommentAdminPanelController.allControllers[c];b.attachClickHandlers();if(!b.isControllingModerationQueue())return;b.deselectComments(a);b.registerModeratorQueueHandlers(false);b.synchronizeModeratorQueueUI();},resetController:function(b){var a=CommentAdminPanelController.allControllers[b];a.resetController();},updateController:function(f,c,g,b,a,d){var e=CommentAdminPanelController.allControllers[f];e.updateController(c,g,b,a,d);if(!CommentAdminPanelController.mainController.loggedIn)MultiLoginPopup.reattachLoginInterceptors();if(!e.isControllingModerationQueue())return;e.registerModeratorQueueHandlers(false);e.synchronizeModeratorQueueUI();},registerMoreCommentsLinkHandler:function(b,c){var a=CommentAdminPanelController.allControllers[b];a.registerMoreCommentsLinkHandler(c);},notifyCommentCreated:function(a){if(!CommentAdminPanelController.mainController.channel)return;UnverifiedXD.send({type:'commentCreated',href:a.href,parentCommentID:a.parentCommentID,commentID:a.commentID});},notifyCommentRemoved:function(a){if(!CommentAdminPanelController.mainController.channel)return;UnverifiedXD.send({type:'commentRemoved',href:a.href,commentID:a.commentID});},markAsShowingAllReplies:function(d){var g=d+' a.fbUpDownVoteOption';var f=DOM.scry(document.documentElement,g);var i=d+' li.fbUpDownVoteOption a.itemAnchor';var h=DOM.scry(document.documentElement,i);var c=f.concat(h);for(var e=0;e<c.length;e++){var a=c[e];var b=new URI(a.getAttribute('ajaxify'));b.addQueryData({show_all_replies:1});a.setAttribute('ajaxify',b.toString());}},setLoggedIn:function(a){CommentAdminPanelController.mainController.loggedIn=a;}});copy_properties(CommentAdminPanelController.prototype,{isControllingModerationQueue:function(){var a=this==CommentAdminPanelController.mainController&&this.inModerationQueue;return a;},resetController:function(){this.commentIDs=[];this.domIDs=[];},updateController:function(d,f,c,b,e){d.forEach(function(g){this.commentIDs.push(g);},this);f.forEach(function(g){this.domIDs.push(g);},this);copy_properties(this.blacklistedActors,c);for(var a in b){if(!this.actorToCommentInfoMap[a])this.actorToCommentInfoMap[a]=[];b[a].forEach(function(g){this.actorToCommentInfoMap[a].push(g);},this);}copy_properties(this.commentInfoMap,e);this.attachClickHandlers();},attachClickHandlers:function(){for(var g=0;g<this.domIDs.length;g++){var e='li[id="'+this.domIDs[g]+'"]';var d=DOM.scry(this.controlledRegion,e);if(d.length===0)continue;var c=d[0];var b=DOM.scry(c,'a.uiCloseButton');Event.listen(c,'mouseleave',this.closeStickyMenuFlyouts.bind(this,b));var k=DOM.scry(c,'.fbModerateDropdownContainer');if(k.length>0){var j=k[0];var l=DOM.find(j,'.fbModerateDropdownLink');Event.listen(l,'mouseover',function(q,event){CSS.addClass(q,'fbUnderlineText');}.curry(l));Event.listen(l,'mouseout',function(q,event){CSS.removeClass(q,'fbUnderlineText');}.curry(l));var f=DOM.find(j,'.fbModerationDropdownList');Event.listen(l,'click',this.exposeDropDownMenu.bind(this,l,f));Event.listen(f.parentNode,'mouseleave',this.concealDropDownMenu.bind(this,l,f));this.attachDropDownHandlers(c,this.commentIDs[g],f);}var a=this.commentInfoMap[this.commentIDs[g]].actor;var h=!!this.recentlyBlacklistedActors[a];if(h){var p=DOM.scry(c,'.fbUndoBlacklistLink');if(p.length>0){var o=p[0];Event.listen(o,'click',this.toggleBlackListAndSync.bind(this,this.commentIDs[g]));}}}var n=DOM.scry(this.controlledRegion,'.fbReplyButton');var m=DOM.scry(this.controlledRegion,'.fbReplyAfterLoginButton');for(var i=0;i<n.length;i++)if(this.loggedIn){CSS.show(n[i]);CSS.hide(m[i]);}else{CSS.hide(n[i]);CSS.show(m[i]);}},closeStickyMenuFlyouts:function(a,event){Toggler.hide();for(var b=0;b<a.length;b++)a[b].blur();},attachDropDownHandlers:function(c,d,e){var b=DOM.scry(e,'.fbBanUser');if(b.length>0){var a=b[0];var f=DOM.find(a,'^.fbFeedbackPost');if(f.id.startsWith(d))Event.listen(a,'click',this.toggleBlackListAndSync.bind(this,d));}},exposeDropDownMenu:function(b,a,event){if(CSS.shown(a))return this.concealDropDownMenu(b,a,event);Event.stop(event);CSS.show(a);a.focus();b.blur();return false;},concealDropDownMenu:function(b,a,event){Event.stop(event);CSS.removeClass(b,'fbUnderlineText');CSS.hide(a);b.blur();return false;},registerMoreCommentsLinkHandler:function(c){var a=c.pager_id;if(!ge(a))return;var b=$(a);Event.listen(b,'click',this.fetchMoreComments.bind(this,c,b));},deselectComments:function(a){for(var b=0;b<a.length;b++)delete this.selectedCommentsMap[a[b]];},registerModeratorQueueHandlers:function(e){if(e)this.selectedCommentsMap={};this.selectableComments=this.findSelectableComments();this.selectableCheckboxes=[];this.selectAllCheckBoxes=DOM.scry(this.controlledRegion,'.fbSelectAllCheckbox');this.approveButtons=DOM.scry(this.controlledRegion,'.fbApproveButton');this.removeButtons=DOM.scry(this.controlledRegion,'.fbRemoveButton');for(var f=0;f<this.selectableComments.length;f++){var c=this.selectableComments[f].id;var d=!!this.selectedCommentsMap[c];this.setCommentSelection(this.selectableComments[f],d);var a=DOM.find(this.selectableComments[f],'.fbCommentCheckbox');var b=DOM.find(this.selectableComments[f],'.UIImageBlock_Content');Event.listen(a,'click',this.toggleCommentSelection.bind(this));Event.listen(this.selectableComments[f],'click',this.toggleCommentSelection.bind(this));a.checked=d;this.selectableCheckboxes.push(a);}for(var g=0;g<this.selectAllCheckBoxes.length;g++){this.selectAllCheckBoxes[g].checked=false;this.selectAllCheckBoxes[g].disabled=this.selectableComments.length===0;Event.listen(this.selectAllCheckBoxes[g],'click',this.toggleSelectAllCheckbox.bind(this,this.selectAllCheckBoxes[g]));}for(var h=0;h<this.approveButtons.length;h++)Event.listen(this.approveButtons[h],'click',this.setBulkPrivacy.bind(this,false));for(var i=0;i<this.removeButtons.length;i++)Event.listen(this.removeButtons[i],'click',this.setBulkPrivacy.bind(this,true));},findSelectableComments:function(){var c=DOM.scry(this.controlledRegion,'.fbTopLevelComment');var b=[];for(var a=0;a<c.length;a++)if((DOM.scry(c[a],'.fbCommentCheckbox').length===1)&&(DOM.scry(c[a],'.fbCommentOverlay').length===0))b.push(c[a]);return b;},toggleCommentSelection:function(event){var b={a:true};var d=event.getTarget();var f=d.tagName.toLowerCase();var e=d.parentNode.tagName.toLowerCase();if(b[f]||b[e])return;var a=CSS.hasClass(d,'fbFeedbackPost')?d:DOM.find(d,'^.fbFeedbackPost');var g=this.commentIsSelected(a);var c=!g;this.setCommentSelection(a,c);this.synchronizeModeratorQueueUI();if(CSS.hasClass(d,'fbCommentCheckbox'))Event.stop(event);},commentIsSelected:function(a){return CSS.hasClass(a,'fbCommentSelected');},setCommentSelection:function(a,b){if(b){this.selectComment(a);}else this.deselectComment(a);},selectComment:function(a){CSS.addClass(a,'fbCommentSelected');this.selectedCommentsMap[a.id]=true;DOM.find(a,'.fbCommentCheckbox').checked=true;},deselectComment:function(a){CSS.removeClass(a,'fbCommentSelected');delete this.selectedCommentsMap[a.id];DOM.find(a,'.fbCommentCheckbox').checked=false;},toggleSelectAllCheckbox:function(a,event){Event.stop(event);var c=a.checked;for(var b=0;b<this.selectableComments.length;b++){this.setCommentSelection(this.selectableComments[b],a.checked);this.selectableCheckboxes[b].checked=c;}this.synchronizeBulkModerationCheckboxes(c);this.synchronizeBulkModerationButtons(c);},synchronizeModeratorQueueUI:function(){var b=0;for(var a=0;a<this.selectableCheckboxes.length;a++)if(this.selectableCheckboxes[a].checked)b++;var c=this.selectableCheckboxes.length>0&&b==this.selectableCheckboxes.length;this.synchronizeBulkModerationCheckboxes(c);this.synchronizeBulkModerationButtons(b>0);},synchronizeBulkModerationCheckboxes:function(b){for(var a=0;a<this.selectAllCheckBoxes.length;a++)this.selectAllCheckBoxes[a].checked=b;},synchronizeBulkModerationButtons:function(c){for(var a=0;a<this.approveButtons.length;a++)Button.setEnabled(this.approveButtons[a],c);for(var b=0;b<this.removeButtons.length;b++)Button.setEnabled(this.removeButtons[b],c);},setBulkPrivacy:function(c,event){Event.stop(event);this.synchronizeBulkModerationButtons(false);selectedCommentIDs=[];for(var b in this.selectedCommentsMap)selectedCommentIDs.push(b);var a={is_private:c,in_moderation_queue:true,comment_ids:selectedCommentIDs,uniqids:selectedCommentIDs,controller_id:this.controllerID,owns_pages:this.userOwnsPages,in_aggregated_view:this.inAggregatedView,in_contextual_dialog:this.inContextualDialog};new AsyncRequest().setURI('/ajax/connect/comments/set_bulk_private.php').setData(a).send();return false;},toggleBlackListAndSync:function(b,event){Event.stop(event);var a=this.commentInfoMap[b].actor;var c={blacklist:!this.blacklistedActors[a],in_moderation_queue:this.inModerationQueue,comment_id:b,other_comment_ids:this.getOtherCommentsByActor(a,b),uniqid:b,controller_id:this.controllerID,owns_pages:this.userOwnsPages,in_aggregated_view:this.inAggregatedView,in_contextual_dialog:this.inContextualDialog};new AsyncRequest().setURI('/ajax/connect/comments/set_blacklist.php').setData(c).setHandler(function(d){this.blacklistedActors[a]=!this.blacklistedActors[a];if(this.blacklistedActors[a]){this.recentlyBlacklistedActors[a]=true;}else delete this.recentlyBlacklistedActors[a];}.bind(this)).send();return false;},getOtherCommentsByActor:function(a,b){return this.actorToCommentInfoMap[a].filter(function(c){return c!=b;});},fetchMoreComments:function(c,b,event){Event.kill(event);CSS.addClass(b,'async_saving');var a={is_reply_thread:false,in_moderation_queue:false,view_as_moderator:false};copy_properties(a,c);a.recently_blacklisted=this.getRecentlyBlacklistedActors();a.offset=this.getVisibleCommentCount(a);if(!a.aggregate_view)delete a.aggregate_view;if(!a.comment_id)delete a.comment_id;if(!a.is_reply_thread){a.comment_ids=this.commentIDs;}else a.offset=0;new AsyncRequest().setURI('/ajax/connect/feedback.php').setReadOnly(true).setData(a).send();},getVisibleCommentCount:function(b){var e=this.getCommentsSelector(b);var a=DOM.scry($(b.controller_id),e);var d=0;for(var c=0;c<a.length;c++)if(!CSS.hasClass(a[c],'fbCommentIgnored'))d++;return d;},getCommentsSelector:function(a){var b=a.is_reply_thread?'li.fbCommentReply':'li.fbTopLevelComment';if(a.controller_id!=a.uniqid)b='div[id="'+a.uniqid+'"] '+b;return b;},getRecentlyBlacklistedActors:function(){var b=[];for(var a in this.recentlyBlacklistedActors)b.push(a);return b;},attachContextualDialogHandlers:function(){this.documentClickListener=Event.listen(document.documentElement,'click',this.closeContextualDialog.bind(this));},closeContextualDialog:function(event){var a=event.getTarget();var b=Parent.byClass(a,'fbCommentContext');if(!b)this.destroyContextualDialog();},destroyContextualDialog:function(){this.documentClickListener.remove();delete this.documentClickListener;var a=this.controllerID;Feedback.closeContextualDialog(a);}});}
function Overlay(){}!function(){var a=null;copy_properties(Overlay,{getInstance:function(b){var c=Parent.byClass(b,'uiOverlay');return c?DataStore.get(c,'overlay'):null;}});Overlay.mixin('Arbiter',{_root:null,_transitionSubscription:null,_hideOnSubmit:false,_hideOnSuccess:true,destroyOnHide:true,init:function(b){this._transitionSubscription=Arbiter.subscribe('page_transition',this.hide.bind(this,true,false),Arbiter.SUBSCRIBE_NEW);this._root=HTML(b).getRootNode();this._arrow=DOM.scry(this._root,'.uiOverlayArrow')[0]||null;this._overlay=DOM.scry(this._root,'div.uiOverlay')[0]||this._root;CSS.hide(this._root);DOM.appendContent(document.body,this._root);DataStore.set(this._overlay,'overlay',this);var c=DataStore.get(this._overlay,'width');c&&this.setWidth(c);this.setHideOnSubmit(DataStore.get(this._overlay,'hideonsubmit')=='true');this.setHideOnSuccess(DataStore.get(this._overlay,'hideonsuccess')!='false');this.setHideOnBlur(DataStore.get(this._overlay,'hideonblur')=='true');this.setDestroyOnHide(DataStore.get(this._overlay,'destroyonhide')!='false');this.setFixed(DataStore.get(this._overlay,'fixed')=='true');Event.listen(this._overlay,{click:this.click.bind(this),submit:this.submit.bind(this),mouseenter:this.inform.shield(this,'mouseenter'),mouseleave:this.inform.shield(this,'mouseleave')});return this;},setHideOnBlur:function(c){var b;function f(){b&&b.remove();b=null;}if(!c&&this._hideOnBlurToken){f();this.unsubscribe(this._hideOnBlurToken);this._hideOnBlurToken=null;}else if(c&&!this._hideOnBlurToken){var d=this;var e=function(){(function(){b=Event.listen(document.documentElement,'click',function(event){if(!DOM.contains(d._overlay,event.getTarget()))d.hide(false);});}).defer();};this.subscribe('hide',f);this._hideOnBlurToken=this.subscribe('show',e);this._shown&&e.call(this);}return this;},setDestroyOnHide:function(b){this.destroyOnHide=b;return this;},setHideOnSubmit:function(b){this._hideOnSubmit=b;return this;},setHideOnSuccess:function(b){this._hideOnSuccess=b;return this;},setWidth:function(b){this.width=parseInt(b,10);return this;},setFixed:function(b){this.fixed=b;return this;},show:function(){if(!this._shown){CSS.show(this._root);CSS.addClass(this._root,'invisible_elem');DOM.appendContent(document.body,this._root);this.updatePosition();CSS.removeClass(this._root,'invisible_elem');this.inform('show');this._shown=true;}return this;},updatePosition:function(){if(this.width)CSS.setStyle(this._overlay,'width',this.width+'px');},hide:function(b){if(!this._shown||this.inform('beforehide')===false)return;var c=function(){if(this._root){DOM.remove(this._root);CSS.setStyle(this._root,'opacity',1);}this.inform('hide');this._shown=false;this.destroyOnHide&&this.destroy();}.bind(this);if(b!==false){animation(this._root).to('opacity',0).duration(250).ondone(c).go();}else c();},destroy:function(){Arbiter.unsubscribe(this._transitionSubscription);DOM.remove(this._root);DataStore.remove(this._root,'overlay');this._root=null;},click:function(c){var b=Parent.byClass(c.getTarget(),'uiOverlayButton');if(b){a=DOM.scry(b,'input')[0];if(CSS.hasClass(b,'uiOverlayCancelButton')){if(this.inform('cancel')!==false)this.hide();c.prevent();}}},submit:function(d){var e=d.getTarget();if(this.inform('submit')===false){d.kill();return;}var f=function(){if(this.inform('success')!==false&&this._hideOnSuccess)this.hide();}.bind(this);if(e.rel==='async'){var g=(Form.getAttribute(e,'method')||'GET').toUpperCase();var c=Form.serialize(e,a);Form.setDisabled(e,true);var h=Parent.byClass(a,'stat_elem')||e;var b=Form.getAttribute(e,'ajaxify')||Form.getAttribute(e,'action');var f=function(){if(this.inform('success')!==false&&this._hideOnSuccess)this.hide();}.bind(this);if(this._hideOnSubmit){f();f=bagofholding;}new AsyncRequest(b).setData(c).setNectarModuleDataSafe(e).setReadOnly(g=='GET').setMethod(g).setStatusElement(h).setRelativeTo(e).setHandler(f).setErrorHandler(function(i){if(this.inform('error',{response:i})!==false)AsyncResponse.defaultErrorHandler(i);}.bind(this)).setFinallyHandler(Form.setDisabled.bind(null,e,false)).send();d.kill();}else f();}});}();
function ContextualDialogX(){this.parent.construct(this);return this;}ContextualDialogX.extend('Overlay');copy_properties(ContextualDialogX,{ARROW_INSET:22,VARROW_HEIGHT:15,TOP_MARGIN:8,BOTTOM_MARGIN:30,HALO_WIDTH:6,getInstance:function(b){var a=DataStore.get(b,'ContextualDialogX');return a||Overlay.getInstance(b);}});ContextualDialogX.prototype={_scrollListener:null,init:function(c){this.parent.init(c);var b=DataStore.get.curry(this._root);this.setAlignH(b('alignh','left'));this.setOffsetX(b('offsetx',0));this.setOffsetY(b('offsety',0));this.setPosition(b('position'));var a=b('context');if(a){this.setContext($(a));}else{a=b('contextselector');if(a)this.setContext(DOM.find(document,a));}this._content=DOM.scry(this._root,'.uiContextualDialogContent')[0];var e=null;var d=null;this.subscribe('show',function(){var f=this.updatePosition.shield(this);e=Event.listen(window,'resize',f);d=Arbiter.subscribe('reflow',f);this._setupScrollListener(this._scrollParent);}.bind(this));this.subscribe('hide',function(){e.remove();Arbiter.unsubscribe(d);this._teardownScrollListener();}.bind(this));},setAlignH:function(a){this.alignH=a;return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(a){a=$(a);if(this.context&&this.context!=a)DataStore.remove(this.context,'ContextualDialogX');this.context=a;var b=Parent.byClass(a,'fbPhotoSnowbox');if(b)b.appendChild(this._root);if(this._scrollListener&&this._scrollParent!==b){this._teardownScrollListener();this._setupScrollListener(b);}this._scrollParent=b;DataStore.set(this.context,'ContextualDialogX',this);return this;},listen:function(b,a){return Event.listen(this._root,b,a);},setOffsetX:function(a){this.offsetX=parseInt(a,10)||0;return this;},setOffsetY:function(a){this.offsetY=parseInt(a,10)||0;return this;},setPosition:function(a){this.position=a;return this;},updatePosition:function(){if(!this.context)return;this.parent.updatePosition();var c=this.fixed?'viewport':'document';var g=Vector2.getElementPosition(this.context,c);var h=this._scrollParent;if(h)g=g.sub(Vector2.getElementPosition(h,'document')).add(h.scrollLeft,h.scrollTop);var a=Vector2.getElementDimensions(this.context);var k=this.position=='above'||this.position=='below';var d=intl_locale_is_rtl();if(d!=(this.position=='right'))g=g.add(a.x,0);if(this.position=='below')g=g.add(0,a.y);var f=new Vector2(0,0);var b=this.width+2*ContextualDialogX.HALO_WIDTH;if(k&&this.alignH=='center'){f=f.add((a.x-b)/2,0);}else{f=f.sub(k?ContextualDialogX.HALO_WIDTH:0,k?0:ContextualDialogX.HALO_WIDTH);var j=k?a.x:a.y;var e=2*(ContextualDialogX.ARROW_INSET+ContextualDialogX.HALO_WIDTH);if(j<e){var i=j/2-ContextualDialogX.ARROW_INSET;f=f.add(k?i:0,k?0:i);}}if(k&&this.alignH=='right')f=f.mul(-1,1).add(a.x-b,0);f=f.add(this.offsetX,this.offsetY);if(d)f=f.mul(-1,1);g=g.add(f);if(this.fixed)g=new Vector2(g.x,g.y,'document');g.setElementPosition(this._root);this._adjustVerticalPosition();},scrollTo:function(){if(this.context)Bootloader.loadComponents('dom-scroll',function(){DOMScroll.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.context&&DataStore.remove(this.context,'ContextualDialogX');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right')return;var c=Vector2.getElementPosition(this._root,'viewport').y;var a=Vector2.getElementDimensions(this._overlay).y;var d=Vector2.getViewportDimensions().y;var b=Math.min(Math.max(0,c+a+ContextualDialogX.BOTTOM_MARGIN-d),Math.max(0,c-ContextualDialogX.TOP_MARGIN),a-2*ContextualDialogX.ARROW_INSET-2*ContextualDialogX.HALO_WIDTH);CSS.setStyle(this._overlay,'top',(-1*b)+'px');CSS.setStyle(this._arrow,'marginTop',b+'px');},_setupScrollListener:function(a){this._scrollListener=Event.listen(a||window,'scroll',this._adjustVerticalPosition.shield(this));},_teardownScrollListener:function(){this._scrollListener.remove();this._scrollListener=null;}};
if(!window.Feedback){window.Feedback=function(){};Feedback.comments={};Feedback.registerComment=function(b,a){Feedback.comments[b]=a;return Feedback;};Feedback.getRegisteredComment=function(a){return Feedback.comments[a];};Feedback.deleteClickHandler=function(f,c,a,e,d){var b=new Dialog().setTitle(_tx("Delete Post")).setBody(_tx("Are you sure you want to delete this post?")).setButtons([Dialog.newButton('delete',_tx("Delete")),Dialog.CANCEL]).setHandler(function(event){new AsyncRequest().setURI('/ajax/connect/feedback.php').setData({command:'delete',url:f,uniqid:e,owns_pages:d,controller_id:a,comment_id:c}).send();}.bind(this)).show();};Feedback.resizeCommentas=function(e){var c=DOM.scry(e,'div.post')[0];if(c){var g=Vector2.getElementDimensions(c).x;if(g){var a=DOM.find(c,'.commentas');var b=Vector2.getElementDimensions(a).x;if((g-b)<190){CSS.setStyle(a,'width',g-190+'px');var f=DOM.scry(a,'span.commentas_inner')[0];if(f){var d=Vector2.getElementDimensions(f).x;CSS.setStyle(a,'width',d+'px');}}}}};Feedback.exposeContextualDialogReply=function(b){var c=$(b);var a=c.parentNode.parentNode;CSS.show(DOM.find(a,"form"));DOM.find(a,"textarea").focus();return false;};Feedback.concealContextualDialogReply=function(b){var f=$(b);var a=f.parentNode.parentNode;var c=DOM.find(a,"form");var e=DOM.find(a,"textarea");var d=e.value.length;if(!Input.getValue(e))CSS.hide(c);return false;};Feedback.closeContextualDialog=function(a){var b=ContextualDialogX.getInstance($(a));b.hide();return false;};Feedback.attachReplyListener=function(a){var b=DOM.find(a,'textarea');a.suppressBlur=false;Event.listen(a,'click',function(c){var d=c.getTarget();var f=Parent.byClass(d,'commentas')!==null;var e=Parent.byClass(d,'uiButton')!==null;var g=Parent.byClass(d,'uiSelector')!==null;a.suppressBlur=f||e||g;});Event.listen(b,'blur',function(d,c){if(a.interval)return;a.interval=(function(e,f){if(e.suppressBlur||Input.getValue(f)||f==document.activeElement)return;CSS.hide(e);e.suppressBlur=false;clearInterval(e.interval);delete e.interval;}).curry(a,d).recur(100);}.curry(b));};Feedback.resetInput=function(b){var a=MentionsInput.getInstance(b);if(a){a.reset({flattened:'',mention_data:{}});}else Input.setValue(b,'');};}
function OpenIDRequest(){var a=new AsyncRequest().setReadOnly(true).setHandler(this.asyncResponseHandler.bind(this)).setErrorHandler(this.asyncErrorHandler.bind(this));copy_properties(this,{openidUrl:null,requestId:OpenIDRequest.maxRequestId++,successResponseHandler:null,cancelHandler:null,intermediateHandler:null,immediateMode:false,useExtensions:true,thirdPartyLogin:false,popupWindow:null,asyncRequest:a,retryCount:0});OpenIDRequest.requests[this.requestId]=this;}OpenIDRequest.getRequestById=function(a){return OpenIDRequest.requests[a];};OpenIDRequest.prototype.setOpenIDUrl=function(a){this.openidUrl=a;return this;};OpenIDRequest.prototype.setSuccessHandler=function(a){this.successResponseHandler=a;return this;};OpenIDRequest.prototype.setErrorHandler=function(a){this.errorHandler=a;return this;};OpenIDRequest.prototype.setCancelHandler=function(a){this.cancelHandler=a;return this;};OpenIDRequest.prototype.setImmediateMode=function(a){this.immediateMode=a;return this;};OpenIDRequest.prototype.setUseExtensions=function(a){this.useExtensions=a;return this;};OpenIDRequest.prototype.setIntermediateHandler=function(a){this.intermediateHandler=a;return this;};OpenIDRequest.prototype.setThirdPartyLogin=function(a){this.thirdPartyLogin=a;return this;};OpenIDRequest.prototype.send=function(){if(!this.openidUrl)throw "openidUrl is a required parameter. Call setOpenIDUrl()";uri=this.calculateRedirectUrl();if(this.immediateMode){this.createHiddenIframe(uri);}else{if(this.popupWindow)throw "OpenID popup is already in progress";this.showPopup(uri);}this.logMetrics('requestSent');};OpenIDRequest.prototype.calculateRedirectUrl=function(b){var a=this.immediateMode?'checkid_immediate':'checkid_setup';var c={'openid.mode':a};var e;if(this.useCacheInfo()&&OpenIDRequest.cache[this.openidUrl]){e=OpenIDRequest.cache[this.openidUrl].url;var d=URI(URI(e).getQueryData()['openid.return_to']);d.addQueryData({context:OpenIDRequest.context,request_id:this.requestId});c['openid.return_to']=d.toString();}else{e='/openid/consumer_helper.php';c.user_claimed_id=this.openidUrl;c.context=OpenIDRequest.context;c.request_id=this.requestId;c.no_extensions=!this.useExtensions;}c.third_party_login=this.thirdPartyLogin;return URI(e).addQueryData(c).getQualifiedURI();};OpenIDRequest.prototype.createHiddenIframe=function(d){var b='openid_request_'+this.requestId,a=document.body.appendChild(document.createElement('div'));var c=function(){a.innerHTML=('<iframe name="'+b+'"'+' src="'+d.toString()+'"'+' scrolling="no" '+' frameborder="0" class="hidden_elem"></iframe>');};if(ua.ie()){a.innerHTML='<iframe src="javascript:false"></iframe>';c.defer();}else c();};OpenIDRequest.prototype.showPopup=function(d){if(OpenIDRequest.cache[this.openidUrl])popupDimensions=OpenIDRequest.cache[this.openidUrl].popup_dimensions;if(typeof(popupDimensions)=="undefined"||!popupDimensions||!popupDimensions['height']||!popupDimensions['width'])popupDimensions={height:'580',width:'790'};var e={x:coalesce(window.screenX,window.screenLeft),y:coalesce(window.screenY,window.screenTop),width:coalesce(window.outerWidth,document.body.clientWidth),height:coalesce(window.outerHeight,document.body.clientHeight)};var a=e.x+((e.width-popupDimensions.width)/2);var c=e.y+((e.height-popupDimensions.height)/2);var b=["location=yes","scrollbars=1","left="+a,"top="+c,"resizable=yes","height="+popupDimensions.height,"width="+popupDimensions.width].join(",");this.popupWindow=window.open(d.toString(),'_blank',b);this.popupPollInterval=setInterval(this.pollPopupWindow.bind(this),100);this.popupWindow.focus();};OpenIDRequest.prototype.pollPopupWindow=function(){if(!(this.popupPollInterval&&this.popupWindow))return;if(this.popupWindow.closed){clearInterval(this.popupPollInterval);this.cancel();}};OpenIDRequest.prototype.closePopupIfOpen=function(){if(this.popupWindow){if(this.popupPollInterval)clearInterval(this.popupPollInterval);this.popupWindow.close();}this.popupWindow=null;};OpenIDRequest.prototype.cancel=function(){this.closePopupIfOpen();if(this.cancelHandler)this.cancelHandler();this.logMetrics('requestCanceled');};OpenIDRequest.prototype.logMetrics=function(a){new AsyncSignal('/ajax/openid/metrics.php',{metric:a,immediate:this.immediateMode,context:OpenIDRequest.context,openid_url:this.openidUrl}).send();};OpenIDRequest.prototype.triggerCompleteAuthAsync=function(a){if(a.charAt(0)=='?'||a.charAt(0)=='&')a=a.substr(1);var b=URI.explodeQuery(a);this.closePopupIfOpen();if(b['openid.mode']=='cancel'){this.cancel();return;}if(this.intermediateHandler)this.intermediateHandler();this.asyncRequest.setData({openid_params:b}).send();};OpenIDRequest.prototype.asyncResponseHandler=function(b){var a=b.getPayload();if(this.successResponseHandler)this.successResponseHandler(a);this.closePopupIfOpen();};OpenIDRequest.prototype.cleanHandleResponse=function(a){if(a.css)a.css=$A(a.css);this.asyncRequest.handleResponse(a);};OpenIDRequest.prototype.asyncErrorHandler=function(a){this.closePopupIfOpen();if(a.error==1428010||a.error==1428011){this.cancel();return;}if(this.errorHandler)this.errorHandler(a);};OpenIDRequest.prototype.retry=function(){++this.retryCount;this.requestId=OpenIDRequest.maxRequestId++;this.send();};OpenIDRequest.prototype.useCacheInfo=function(){return (this.retryCount==0);};OpenIDRequest.setProviderCache=function(a){OpenIDRequest.cache=a;};OpenIDRequest.cache={};OpenIDRequest.requests=[];OpenIDRequest.maxRequestId=0;OpenIDRequest.context='default';